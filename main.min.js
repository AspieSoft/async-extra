const sleep=e=>new Promise((t=>setTimeout(t,e)));async function waitForValue(e,t=1e4,n=10){if(n<1&&(n=1),"function"==typeof e){e()&&e();let i=0;for(;!(e()||(await sleep(n),i++,!1!==t&&i>=t/n)););return e()}return console.error("TypeError: waitForValue expects a function with a return value"),!1}function forEach(e,t){if("string"==typeof e&&(e=[e]),e&&"object"==typeof e){let n=Object.keys(e);for(let i=0;i<n.length;i++)t(e[n[i]],n[i],e)}else if(e&&Array.isArray(e))for(let n=0;n<e.length;n++)t(e[n],n,e)}module.exports={function:function(){let e={timeout:1e4,checkInterval:10},t=0,n=0,i=[];return arguments&&arguments.length>0&&("object"==typeof arguments[0]&&"function"!=typeof arguments[0]&&Object.assign(e,arguments[0]),e.resultObject&&(i={}),t=arguments.length,forEach(arguments,(async(e,t)=>{"function"==typeof e&&(i[t]=await e()),n++}))),{options:function(t,n){"object"==typeof t?Object.assign(e,t):"string"==typeof t&&(e[t]=n)},add:function(){"object"==typeof arguments[0]&&"function"!=typeof arguments[0]&&Object.assign(e,arguments[0]);let o=t;t+=arguments.length,forEach(arguments,(async(e,t)=>{t=Number(t)+Number(o),"function"==typeof e&&(i[t]=await e()),n++}))},addIndex:function(e,o){t++,(async()=>{i[e]=await o(),n++})()},onFinish:function(o){return waitForValue((()=>n>=t),e.timeout,e.checkInterval).then((()=>{const e=n>=t;return"function"==typeof o&&i.forEach(((t,n)=>{void 0!==t&&o(t,n,i,e)})),{results:i,finished:e,unfinished:t-n}}))},wait:async function(){return await waitForValue((()=>n>=t),e.timeout,e.checkInterval),!(n<t)&&t-n},result:async function(){return await waitForValue((()=>n>=t),e.timeout,e.checkInterval),{results:i,finished:n>=t,unfinished:t-n}},resultSync:function(){return{results:i,finished:n>=t,unfinished:t-n}},firstResult:function(){return waitForValue((()=>n>=1),e.timeout,e.checkInterval).then((()=>{const e=n>=t;let o,r=!1;return forEach(i,((e,t)=>{void 0===o&&void 0!==e&&(o=e,r=t)})),{result:o,index:r,results:i,finished:e,unfinished:t-n}}))},resultIndex:function(t=0){return waitForValue((()=>void 0!==i[t]),e.timeout,e.checkInterval).then((()=>({result:i[t],index:t})))}}},forEach:function(e,t,n){if(!e||"function"!=typeof t)return;"object"==typeof e||Array.isArray(e)||(e=[e]);let i={timeout:1e4,checkInterval:10};"object"==typeof n&&Object.assign(i,n);let o=e.length;return"object"==typeof e&&(o=Object.keys(e).length),forEach(e,(async(n,i)=>{await t(n,i,e),o--})),waitForValue((()=>o<=0),i.timeout,i.checkInterval).then((()=>({finished:o<=0,unfinished:o})))},map:function(e,t,n){if(!e||"function"!=typeof t)return;"object"==typeof e||Array.isArray(e)||(e=[e]);let i={timeout:1e4,checkInterval:10};"object"==typeof n&&Object.assign(i,n);let o=e.length;"object"==typeof e&&(o=Object.keys(e).length);let r=function(e){return Array.isArray(e)?[]:"object"==typeof e?{}:void 0}(e);return forEach(e,(async(n,i)=>{r[i]=await t(n,i,e),o--})),waitForValue((()=>o<=0),i.timeout,i.checkInterval).then((()=>({result:r,finished:o<=0,unfinished:o})))},sleep,waitForValue};